#!/bin/bash

# Check if at least two arguments are provided
if [[ $# -lt 2 ]]; then
  echo "Usage: aoc <part> <input>"
  exit 1
fi

file="part$1.cpp"
input="input.$2"

LTIME=`stat -c %Z $file`

while true; do
    ATIME=`stat -c %Z $file`

    if [[ $ATIME != $LTIME ]] then
        LTIME=$ATIME

        echo -e "\nCompiling source..."

        clang++ -o main \
            -std=c++20 \
            -O3 \
            $file

        if [[ $? != 0 ]] then
            echo -e "Compilation failed.\n"
            continue
        fi
        
        echo -e "Running...\n"

        start_time_us=$(echo $EPOCHREALTIME | tr -d '.')
        ./main < $input
        end_time_us=$(echo $EPOCHREALTIME | tr -d '.')
        rm main

        delta_ms=$(( (end_time_us - start_time_us) / 1000 ))

        printf '\n\n┌%*s\n' 15 | tr ' ' '-'
        echo -e "| Took \e[31m$delta_ms\e[0m ms"
        printf '└%*s' $(($COLUMNS - 1)) | tr ' ' '-'
    fi
    sleep 1
done

