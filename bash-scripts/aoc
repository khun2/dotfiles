#!/bin/bash

# Check if at least two arguments are provided
if [[ $# -lt 2 ]]; then
  echo "Usage: aoc <part> <input>"
  exit 1
fi

# Validate that both arguments are numbers
if ! [[ "$1" =~ ^[0-9]+$ ]] || ! [[ "$2" =~ ^[0-9]+$ ]]; then
  echo "Error: both arguments must be numbers"
  exit 1
fi

file="part$1.cpp"
input="input.$2"

LTIME=`stat -c %Z $file`

while true; do
    ATIME=`stat -c %Z $file`

    if [[ $ATIME != $LTIME ]] then
        LTIME=$ATIME

        echo "Compiling source..."

        clang++ -o main \
            -std=c++20 \
            -O3 \
            $file

        start_time=$EPOCHREALTIME
        ./main < $input
        end_time=$EPOCHREALTIME

        printf '%*s' $COLUMNS | tr ' ' '-'
        echo "Watching $file for changes..."
    fi
    sleep 0.1
    
    # # Compile the source
    #
    # # Run the executable with the provided input
    # time ./main < "input.$2"
done

