#!/bin/bash

# Check if at least two arguments are provided
if [[ $# -lt 2 ]]; then
  echo "Usage: aoc <part> <input>"
  exit 1
fi

# Validate that both arguments are numbers
if ! [[ "$1" =~ ^[0-9]+$ ]] || ! [[ "$2" =~ ^[0-9]+$ ]]; then
  echo "Error: both arguments must be numbers"
  exit 1
fi

file="part$1.cpp"
input="input.$2"

LTIME=`stat -c %Z $file`

while true; do
    ATIME=`stat -c %Z $file`

    if [[ $ATIME != $LTIME ]] then
        LTIME=$ATIME

        echo -e "\nCompiling source...\n"

        clang++ -o main \
            -std=c++20 \
            -O3 \
            $file

        start_time_us=$(echo $EPOCHREALTIME | tr -d '.')
        ./main < $input
        end_time_us=$(echo $EPOCHREALTIME | tr -d '.')

        delta_ms=$(( (end_time_us - start_time_us) / 1000 ))

        printf '\n\n┌%*s\n' 15 | tr ' ' '-'
        echo -e "| Took \e[31m$delta_ms\e[0m ms"
        printf '└%*s' $(($COLUMNS - 1)) | tr ' ' '-'
        echo -n "Watching $file for changes..."
    fi
    sleep 0.1
    
    # # Compile the source
    #
    # # Run the executable with the provided input
    # time ./main < "input.$2"
done

